name: FHIR IG Build and Deploy

# Triggers the workflow on pushes to the 'main' branch
on:
  push:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    # Permissions are required for the GITHUB_TOKEN to push to the gh-pages branch
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: üì¶ Checkout Repository
        # Fetches all history (depth: 0) needed by the IG Publisher for versioning
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üõ†Ô∏è Build FHIR Implementation Guide (SUSHI + IG Publisher)
        # Uses the community action to execute the entire build process
        uses: qligier/fhir-ig-action@v0.3.0
        with:
          # Set the SUSHI version. 'latest' is recommended.
          # Change to 'false' if your IG is built from pre-generated JSON files.
          sushi: "latest"
          # Set the IG Publisher version. 'latest' is recommended.
          ig-publisher: "latest"
          # NOTE: The output folder 'output/' is generated in the root by this action.

      - name: üöÄ Deploy to GitHub Pages
        # Uses the peaceiris action to take the static output and push it to the deployment branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          # Use the default GITHUB_TOKEN created by the runner
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # The directory generated by the fhir-ig-action
          publish_dir: ./output
          # The branch GitHub Pages serves from. Default is gh-pages.
          publish_branch: gh-pages
